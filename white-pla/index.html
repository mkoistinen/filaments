<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>White FDM Filament Color Comparison | PLA 3D Printing Filaments</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="White FDM Filament Color Comparison | PLA 3D Printing Filaments">
    <meta name="description" content="Compare white PLA filament colors from top brands like Sunlu, Hatchbox, eSun, and Prusament. Scientifically measured LAB color values for 3D printing perfection. Find the best white filament for your project with detailed color analysis and price comparisons.">
    <meta name="keywords" content="white PLA filament, 3D printing filament, white filament comparison, PLA color comparison, LAB color values, 3D printing, FDM filament, Sunlu, Hatchbox, eSun, Prusament, Overture, white filament review, best white PLA, filament color database, CIELAB color space, 3D printing materials">
    <meta name="author" content="mkoistinen">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="theme-color" content="#ffffff">
    <link rel="canonical" href="https://mkoistinen.github.io/filaments/white-pla/">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="language" content="en">
    <meta name="rating" content="general">
    <meta name="distribution" content="global">
    <meta name="revisit-after" content="7 days">
    <meta name="format-detection" content="telephone=no">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mkoistinen.github.io/filaments/white-pla/">
    <meta property="og:title" content="White FDM Filament Color Comparison | PLA 3D Printing Filaments">
    <meta property="og:description" content="Compare white PLA filament colors from top brands like Sunlu, Hatchbox, eSun, and Prusament. Scientifically measured LAB color values for 3D printing perfection. Find the best white filament for your project with detailed color analysis and price comparisons.">
    <meta property="og:site_name" content="Filament Color Database">
    <meta property="og:locale" content="en_US">
    <meta property="og:image" content="https://mkoistinen.github.io/filaments/white-pla/og-image.png">
    <meta property="og:image:alt" content="White PLA Filament Color Comparison Chart">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mkoistinen.github.io/filaments/white-pla/">
    <meta property="twitter:title" content="White FDM Filament Color Comparison | PLA 3D Printing Filaments">
    <meta property="twitter:description" content="Compare white PLA filament colors from top brands like Sunlu, Hatchbox, eSun, and Prusament. Scientifically measured LAB color values for 3D printing perfection.">
    <meta property="twitter:image" content="https://mkoistinen.github.io/filaments/white-pla/og-image.png">
    <meta property="twitter:image:alt" content="White PLA Filament Color Comparison Chart">
    <meta name="twitter:creator" content="@mkoistinen">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "White FDM Filament Color Comparison",
      "description": "A comprehensive comparison of white PLA filament colors from various manufacturers, featuring scientifically measured LAB color values.",
      "url": "https://mkoistinen.github.io/filaments/white-pla/",
      "author": {
        "@type": "Person",
        "name": "mkoistinen"
      },
      "datePublished": "2025-11-17",
      "dateModified": "2026-01-19",
      "mainEntity": {
        "@type": "ItemList",
        "name": "White PLA Filament Comparison",
        "description": "Comparison of white PLA filaments from various brands with LAB color measurements",
        "numberOfItems": 8,
        "itemListElement": [
          {
            "@type": "Product",
            "name": "Sunlu White PLA",
            "description": "White PLA filament with LAB color value 94.2, -2.2, -0.1 - highest lightness value",
            "brand": {
              "@type": "Brand",
              "name": "Sunlu"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "16.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.amazon.com/dp/B07ZNHF46J"
            }
          },
          {
            "@type": "Product",
            "name": "Push Plastic White PLA",
            "description": "White PLA filament with LAB color value 92.6, -1.8, -0.6",
            "brand": {
              "@type": "Brand",
              "name": "Push Plastic"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "24.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.pushplastic.com/products/pla-filament-1-75mm-1kg"
            }
          },
          {
            "@type": "Product",
            "name": "eSun Basic PLA - White",
            "description": "White PLA filament with LAB color value 92.4, -2.1, -2.2",
            "brand": {
              "@type": "Brand",
              "name": "eSun"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "11.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.amazon.com/dp/B0CS2XHNKL"
            }
          },
          {
            "@type": "Product",
            "name": "Hatchbox White PLA",
            "description": "White PLA filament with LAB color value 92.2, -2.3, -0.4",
            "brand": {
              "@type": "Brand",
              "name": "Hatchbox"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "28.00",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.amazon.com/dp/B0BM559SBC"
            }
          },
          {
            "@type": "Product",
            "name": "ProtoPasta Opaque White HTPLA",
            "description": "High-temperature white PLA filament with LAB color value 91.1, -2.0, -0.4",
            "brand": {
              "@type": "Brand",
              "name": "ProtoPasta"
            },
            "category": "3D Printing Filament",
            "material": "HTPLA (High Temperature PLA)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "49.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://proto-pasta.com/products/premium-htpla-v3-white"
            }
          },
          {
            "@type": "Product",
            "name": "Overture White Pro PLA",
            "description": "White Pro PLA filament with LAB color value 90.5, -2.3, -1.2",
            "brand": {
              "@type": "Brand",
              "name": "Overture"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "15.65",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.amazon.com/dp/B07VGV5VSZ"
            }
          },
          {
            "@type": "Product",
            "name": "Prusament Pristine White PLA",
            "description": "Pristine white PLA filament with LAB color value 83.4, -1.2, -1.7",
            "brand": {
              "@type": "Brand",
              "name": "Prusament"
            },
            "category": "3D Printing Filament",
            "material": "PLA (Polylactic Acid)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "26.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.prusa3d.com/product/prusament-pla-pristine-white-1kg/"
            }
          },
          {
            "@type": "Product",
            "name": "Elegoo White PLA Plus",
            "description": "White PLA Plus filament with LAB color value 85.9, 0.1, -0.8",
            "brand": {
              "@type": "Brand",
              "name": "Elegoo"
            },
            "category": "3D Printing Filament",
            "material": "PLA+ (Enhanced PLA)",
            "color": "White",
            "offers": {
              "@type": "Offer",
              "price": "14.99",
              "priceCurrency": "USD",
              "availability": "https://schema.org/InStock",
              "url": "https://www.amazon.com/dp/B0BM7WZPXJ"
            }
          }
        ]
      }
    }
    </script>

    <!-- FAQ Structured Data for AI Search Engines -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "What is the difference between white PLA filaments?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "White PLA filaments vary significantly in their actual color appearance. Some are cooler (bluish) while others are warmer (yellowish). The differences are measured using CIELAB color space, which provides objective color measurements including lightness (L), green-red axis (a), and blue-yellow axis (b). These measurements help you choose the exact shade of white you need for your project."
          }
        },
        {
          "@type": "Question",
          "name": "What is LAB color space in 3D printing?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "LAB (also called CIELAB or L*a*b*) is a color space that represents colors using three values: L (lightness from 0-100), a (green to red axis), and b (blue to yellow axis). It's a device-independent color space that provides more accurate color representation than RGB, making it ideal for comparing filament colors objectively. LAB measurements ensure consistent color comparison regardless of display or lighting conditions."
          }
        },
        {
          "@type": "Question",
          "name": "Which white PLA filament is the brightest?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "According to our LAB color measurements, Sunlu White PLA has the highest lightness value (L=94.2), making it the brightest white filament in our comparison. Other high-lightness options include Push Plastic White PLA (L=92.6) and eSun Basic PLA White (L=92.4)."
          }
        },
        {
          "@type": "Question",
          "name": "How are the filament colors measured?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "All filaments are printed into samples on a Prusa MK4S or CORE One using the same generic PLA filament profile. Colors are measured using a Pico Colorimeter in the same environment with consistent ambient lighting and temperature. Each measurement is the average of 3 samples taken from surfaces printed along different Cartesian planes (XY, XZ, YZ) to ensure accuracy and account for directional color variations."
          }
        },
        {
          "@type": "Question",
          "name": "Can I add my own filament color to the comparison?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! The page allows you to add personal colors to the comparison table. You can input colors in various formats including LAB, RGB, HSV, or Hex. Personal colors are stored in your browser's local storage and can be shared with others via a URL. This feature helps you compare your own filaments against the measured database."
          }
        }
      ]
    }
    </script>

    <!-- BreadcrumbList Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://mkoistinen.github.io/filaments/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "White PLA Filament Comparison",
          "item": "https://mkoistinen.github.io/filaments/white-pla/"
        }
      ]
    }
    </script>

    <!-- Article/TechArticle Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "TechArticle",
      "headline": "White FDM Filament Color Comparison",
      "description": "A comprehensive comparison of white PLA filament colors from various manufacturers, featuring scientifically measured LAB color values and price comparisons.",
      "image": "https://mkoistinen.github.io/filaments/white-pla/og-image.png",
      "author": {
        "@type": "Person",
        "name": "mkoistinen",
        "url": "https://github.com/mkoistinen"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Filament Color Database",
        "url": "https://mkoistinen.github.io/filaments/"
      },
      "datePublished": "2025-11-17",
      "dateModified": "2026-01-19",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://mkoistinen.github.io/filaments/white-pla/"
      },
      "keywords": "white PLA filament, 3D printing, LAB color values, FDM filament, color comparison, CIELAB, 3D printing materials, filament review",
      "articleSection": "3D Printing Materials",
      "articleBody": "This page provides a comprehensive comparison of white PLA filaments from various manufacturers including Sunlu, Hatchbox, eSun, Prusament, and more. Each filament is scientifically measured using CIELAB color space to provide objective color values.",
      "inLanguage": "en-US"
    }
    </script>
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #24292e;
            --border-color: #d0d7de;
            --table-header-bg: #f6f8fa;
            --table-header-hover: #e8ecef;
            --button-bg: #fff;
            --button-hover: #f0f0f0;
            --button-active-bg: #0969da;
            --button-active-color: #fff;
            --heading-border: #eaecef;
            --swatch-border: #999;
            --link-color: #0969da;
            --link-visited-color: #8250df;
            --link-hover-color: #0550ae;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-color: #0d1117;
                --text-color: #c9d1d9;
                --border-color: #30363d;
                --table-header-bg: #161b22;
                --table-header-hover: #1f2428;
                --button-bg: #21262d;
                --button-hover: #30363d;
                --button-active-bg: #1f6feb;
                --button-active-color: #fff;
                --heading-border: #21262d;
                --swatch-border: #6e7681;
                --link-color: #58a6ff;
                --link-visited-color: #bc8cff;
                --link-hover-color: #79c0ff;
            }
        }

        body.light-mode {
            --bg-color: #ffffff;
            --text-color: #24292e;
            --border-color: #d0d7de;
            --table-header-bg: #f6f8fa;
            --table-header-hover: #e8ecef;
            --button-bg: #fff;
            --button-hover: #f0f0f0;
            --button-active-bg: #0969da;
            --button-active-color: #fff;
            --heading-border: #eaecef;
            --swatch-border: #999;
            --link-color: #0969da;
            --link-visited-color: #8250df;
            --link-hover-color: #0550ae;
        }

        body.dark-mode {
            --bg-color: #0d1117;
            --text-color: #c9d1d9;
            --border-color: #30363d;
            --table-header-bg: #161b22;
            --table-header-hover: #1f2428;
            --button-bg: #21262d;
            --button-hover: #30363d;
            --button-active-bg: #1f6feb;
            --button-active-color: #fff;
            --heading-border: #21262d;
            --swatch-border: #6e7681;
            --link-color: #58a6ff;
            --link-visited-color: #bc8cff;
            --link-hover-color: #79c0ff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        a {
            color: var(--link-color);
        }
        a:visited {
            color: var(--link-visited-color);
        }
        a:hover {
            color: var(--link-hover-color);
        }
        h1 {
            border-bottom: 1px solid var(--heading-border);
            padding-bottom: 0.3em;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        h2 {
            border-bottom: 1px solid var(--heading-border);
            padding-bottom: 0.3em;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        p {
            margin-bottom: 16px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 16px;
        }
        th {
            background-color: var(--table-header-bg);
            font-weight: 600;
            padding: 6px 13px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            user-select: none;
        }
        th:hover {
            background-color: var(--table-header-hover);
        }
        th.sorted-asc::after {
            content: ' â†‘';
            opacity: 1;
        }
        th.sorted-desc::after {
            content: ' â†“';
            opacity: 1;
        }
        td {
            padding: 6px 13px;
            border: 1px solid var(--border-color);
            transition: background-color 0.2s ease;
        }
        td:nth-child(4) {
            text-align: right;
        }
        td:nth-child(4) a {
            text-decoration: none;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
        }
        td:nth-child(4) a:hover {
            text-decoration: underline;
        }
        td:nth-child(4) img.favicon {
            width: 16px;
            height: 16px;
            vertical-align: middle;
        }
        tbody tr.selected td a,
        tbody td[style*="background-color"] a {
            color: #000000 !important;
        }
        tbody tr {
            cursor: pointer;
        }
        .copy-btn {
            display: none;
            width: 24px;
            height: 24px;
            padding: 0;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.85em;
            line-height: 24px;
            text-align: center;
            transition: all 0.2s;
            color: var(--text-color);
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            user-select: none;
        }
        .copy-btn:hover {
            background: var(--button-hover);
        }
        .copy-btn:active {
            background: var(--button-active-bg);
            color: var(--button-active-color);
        }
        tbody tr:hover .copy-btn,
        tbody tr.selected .copy-btn {
            display: inline-block;
        }
        .color-cell {
            position: relative;
            padding-right: 40px;
        }
        tbody tr[data-user-color="true"] .color-cell {
            padding-right: 104px;  /* Space for all 3 buttons: delete, share, copy */
        }
        .color-mode-switcher {
            display: flex;
            gap: 5px;
            margin-bottom: 16px;
            align-items: center;
        }
        .color-mode-btn {
            padding: 6px 12px;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
            color: var(--text-color);
        }
        .color-mode-btn:hover {
            background: var(--button-hover);
        }
        .color-mode-btn.active {
            background: var(--button-active-bg);
            color: var(--button-active-color);
            border-color: var(--button-active-bg);
        }
        .color-swatch {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 0px solid var(--swatch-border);
            border-radius: 3px;
            vertical-align: middle;
            margin-right: 8px;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 8px 16px;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.2s;
            color: var(--text-color);
        }
        .theme-toggle:hover {
            background: var(--button-hover);
        }

        /* Responsive design for mobile */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 14px;
            }

            h1 {
                font-size: 1.5em;
                margin-top: 16px;
            }

            h2 {
                font-size: 1.2em;
            }

            .theme-toggle {
                top: 10px;
                right: 10px;
                padding: 6px 12px;
                font-size: 0.85em;
            }

            .color-mode-switcher {
                flex-wrap: wrap;
                gap: 4px;
            }

            .color-mode-btn {
                padding: 5px 10px;
                font-size: 0.85em;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 4px 8px;
            }

            .color-swatch {
                width: 20px;
                height: 20px;
                margin-right: 6px;
            }

            /* Make table scrollable horizontally on very small screens */
            .table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
        }

        @media screen and (max-width: 480px) {
            body {
                padding: 5px;
                font-size: 13px;
            }

            h1 {
                font-size: 1.3em;
            }

            .color-mode-btn {
                font-size: 0.8em;
                padding: 4px 8px;
            }

            table {
                font-size: 0.85em;
            }

            th, td {
                padding: 3px 6px;
            }

            .color-swatch {
                width: 18px;
                height: 18px;
                margin-right: 4px;
            }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: var(--bg-color);
            margin: 10% auto;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            margin: 0;
            border: none;
            padding: 0;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1em;
            background-color: var(--button-bg);
            color: var(--text-color);
            box-sizing: border-box;
        }

        .form-group input::placeholder {
            color: var(--text-color);
            opacity: 0.5;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .modal-btn {
            padding: 8px 16px;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .modal-btn:hover:not(:disabled) {
            background: var(--button-hover);
        }

        .modal-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal-btn.primary {
            background: var(--button-active-bg);
            color: var(--button-active-color);
            border-color: var(--button-active-bg);
        }

        .modal-btn.primary:hover:not(:disabled) {
            opacity: 0.9;
        }

        .modal-btn.danger {
            background: #dc3545;
            color: white;
            border-color: #dc3545;
        }

        .modal-btn.danger:hover {
            background: #c82333;
            border-color: #bd2130;
        }

        .add-color-btn {
            padding: 8px 16px;
            background: var(--button-active-bg);
            color: var(--button-active-color);
            border: 1px solid var(--button-active-bg);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
            margin-bottom: 16px;
        }

        .add-color-btn:hover {
            opacity: 0.9;
        }

        /* Edit and Share icon styles - absolute positioning in color cell */
        td {
            position: relative;
        }

        .edit-icon {
            display: none;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 72px;  /* Position to the left of share icon (24px share + 24px copy + 16px gaps) */
            width: 24px;
            height: 24px;
            padding: 0;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.85em;
            line-height: 24px;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
        }

        tbody tr:hover .edit-icon,
        tbody tr.selected .edit-icon {
            display: inline-block;
        }

        .edit-icon:hover {
            background: var(--button-hover);
        }

        /* Share icon styles - positioned between edit and copy */
        .share-icon {
            display: none;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            right: 40px;  /* Position between delete and copy (24px copy + 8px gap) */
            width: 24px;
            height: 24px;
            padding: 0;
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 3px;
            color: var(--text-color);
            cursor: pointer;
            font-size: 0.85em;
            line-height: 24px;
            text-align: center;
            transition: all 0.2s;
            user-select: none;
        }

        tbody tr:hover .share-icon,
        tbody tr.selected .share-icon {
            display: inline-block;
        }

        .share-icon:hover {
            background: var(--button-hover);
        }

        /* Confirmation modal styles */
        .confirm-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .confirm-modal-content {
            background-color: var(--bg-color);
            margin: 15% auto;
            padding: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .confirm-modal-header {
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 1.1em;
        }

        .confirm-modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .confirm-btn-delete {
            padding: 8px 16px;
            background: #dc3545;
            color: white;
            border: 1px solid #dc3545;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
        }

        .confirm-btn-delete:hover {
            background: #c82333;
            border-color: #c82333;
        }

        .confirm-btn-cancel {
            padding: 8px 16px;
            background: var(--button-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.2s;
        }

        .confirm-btn-cancel:hover {
            background: var(--button-hover);
        }
    </style>
</head>
<body>
    <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle color theme">
        <span id="theme-icon">ðŸŒ™</span> <span id="theme-text">Dark</span>
    </button>

    <header>
        <h1>White FDM Filament Color Comparison</h1>
    </header>

    <main>

    <p>
        "White" is a very relative term, especially in the Thermoplastics
        space. I'm on a quest for the best looking white for my application.
        This webpage presents my own findings for all the white filaments I
        come across.
    </p>
    <p>
        I previously posted my results on a <a href="https://www.reddit.com/r/3Dprinting/comments/10tv174/quality_white_pla_filament/" rel="noopener noreferrer"><img src="https://www.google.com/s2/favicons?domain=reddit.com&amp;sz=12" alt="Reddit" class="favicon"> Reddit post</a> in the 3Dprinting
        sub-reddit. However, at some point, I was unable to update the post with
        new filaments due to age or perhaps post-length, so, this page was born.
    </p>
    <p>
        All the filaments shown in the table below were printed into samples on
        my Prusa MK4S or CORE One using the same generic PLA filament profile.
        Colors are measured using my specific Pico Colorimeter in the same
        environment with the same ambient lighting and roughly the same
        temperature. The measurements are the average of 3 samples take from
        surfaces printed along the different Cartesian planes (XY, XZ, YZ). The
        color is stored as <a href="https://en.wikipedia.org/wiki/CIELAB_color_space"><img src="https://www.google.com/s2/favicons?domain=wikipedia.com&amp;sz=12" alt="Wikipedia" class="favicon"> CIELAB</a>
        (Also "L.a.b." or just "Lab") format&mdash;which is the highest
        resolution color specification my Pico device can produce&mdash;on this
        webpage and all other color formats are derived from that value. And
        all sorting is done against the Lab color despite which color format is
        selected for display.
    </p>
    <p>
        The recorded values are different than previously presented on the
        Reddit post. The primary reason for this the my new practice of
        averaging 3 measurements for each of the Cartesian planes of printing.
        This was most notable for the Silk-effect filaments, which are likely
        engineered to reflect different color light in different directions.
        Interestingly, all of the filaments had some degree of visible variance
        when measured this way.
    </p>

    <section aria-labelledby="color-swatches-heading">
    <h3 id="color-swatches-heading">Color Swatches</h3>
    <p>
        The color swatches shown in the Color column of the table below use a
        <a href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering"><img src="https://www.google.com/s2/favicons?domain=wikipedia.com&amp;sz=12" alt="Wikipedia" class="favicon"> Floyd-Steinberg dithering algorithm</a>
        for achieving sub-pixel accuracy when the Lab color falls between
        discrete RGB values (e.g., RGB 245.7 instead of 246). Dithered swatches
        use a carefully calculated pattern of pixels to create a more accurate
        perceptual representation than is possible with sRGB colors alone.
    </p>
    <p>
        Additionally, if you roll over or touch a specific filament, the
        background color of all filaments in the Color column will reflect the
        indicated filament. This makes it easy to see the difference of the
        indicated filament color versus the remaining ones. Try it!
    </p>
    <p>
        Despite all these efforts to improve the accuracy, the color swatches
        are still only <strong>rough approximations</strong> of the sampled
        colors and should be treated as such. They are probably most visually
        accurate when the page is viewed in dark mode, but displaying a color
        in an HTML color swatch or even a photograph on an arbitrary display
        cannot truly represent how these 3D printed samples appear when
        observed in person under arbitrary lighting conditions. Regardless, I
        can attest that the <em>relative</em> differences between colors are
        represented by these HTML color swatches.
    </p>
    </section>

    <section aria-labelledby="filament-table-heading">
    <h2 id="filament-table-heading">The Filament Table</h2>
    <p>
        They are initially organized by "lightness" (L value in Lab) from
        highest to lowest but you can click a column header to sort differently.
    </p>

    <div class="color-mode-switcher">
        <strong>Color Format:</strong>
        <button class="color-mode-btn active" data-mode="lab">Lab</button>
        <button class="color-mode-btn" data-mode="rgb">RGB</button>
        <button class="color-mode-btn" data-mode="hsv">HSV</button>
        <button class="color-mode-btn" data-mode="hex">Hex</button>
        <strong style="padding-left: 2em;">Sort by:</strong>
        <button class="color-mode-btn" data-sort="lightness" title="Sort by the magnitude of the Lab Lightness value.">Lightness â†“</button>
        <button class="color-mode-btn" data-sort="hue" title="Sort by Lab a-axis (green-red)">Tint Hue â†‘</button>
        <button class="color-mode-btn" data-sort="warmth" title="Sort by Lab b-axis (blue-yellow)">Tint Warmth â†‘</button>
        <button class="color-mode-btn" data-sort="strength" title="Sort by the magnitude of the Lab a- and b-axes together.">Tint Strength â†‘</button>
    </div>

    <div class="table-container">
        <table id="filamentTable" role="table" aria-label="White PLA filament comparison data">
            <thead>
                <tr>
                    <th data-sort="brand">Brand</th>
                    <th data-sort="polymer">Color/Polymer</th>
                    <th data-sort="color">Color</th>
                    <th data-sort="cost">USD/Kg</th>
                    <th data-sort="date">Date Added</th>
                </tr>
        </thead>
        <tbody>
           <tr data-lab="94.2, -2.2, -0.1" data-asin="B07ZNHF46J">
                <td>Sunlu</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B07ZNHF46J?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">16.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="92.6, -1.8, -0.6" data-asin="">
                <td>Push Plastic</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.pushplastic.com/products/pla-filament-1-75mm-1kg?variant=45108523794593"><img src="https://www.google.com/s2/favicons?domain=pushplastic.com&sz=32" alt="Push Plastic" class="favicon">24.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="92.4, -2.1, -2.2" data-asin="B0CS2XHNKL">
                <td>eSun</td>
                <td>Basic PLA - White</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0CS2XHNKL?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">11.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="92.2, -2.3, -0.4" data-asin="B0BM559SBC">
                <td>Hatchbox</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0BM559SBC?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">28.00</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="91.1, -2.0, -0.4" data-asin="">
                <td>ProtoPasta</td>
                <td>Opaque White HTPLA</td>
                <td class="color-cell"></td>
                <td><a href="https://proto-pasta.com/products/premium-htpla-v3-white?variant=40714988872"><img src="https://www.google.com/s2/favicons?domain=proto-pasta.com&sz=32" alt="ProtoPasta" class="favicon">49.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="90.8, -0.6, -0.6" data-asin="">
                <td>Polymaker</td>
                <td>Polylite PLA - White</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B099K1TCFM?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">17.24</a></td>
                <td data-date="20251124">24-Nov-2025</td>
            </tr>
            <tr data-lab="90.5, -2.3, -1.2" data-asin="B07VGV5VSZ">
                <td>Overture</td>
                <td>White Pro PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B07VGV5VSZ?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">15.65</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="90.4, -1.0, 0.1" data-asin="B089S1HB8K">
                <td>Overture</td>
                <td>White Matte PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B089S1HB8K?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">15.12</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="89.7, -1.9, -3.6" data-asin="B0D25PGVYH">
                <td>eSun</td>
                <td>Cool White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0D25PGVYH?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">22.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="89.3, 2.8, -7.8" data-asin="B094PY34KX">
                <td>Bblife</td>
                <td>Silk White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B094PY34KX?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">21.59</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="89.2, -0.3, -5.0" data-asin="B0FCT42J5Q">
                <td>Gryddle</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0FCT42J5Q?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">9.99</a></td>
                <td data-date="20251119">19-Nov-2025</td>
            </tr>
            <tr data-lab="87.6, -0.6, -1.7" data-asin="B0FHWJPBH8">
                <td>Soleyin</td>
                <td>Ultra PLA White</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0FHWJPBH8?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">12.99</a></td>
                <td data-date="20251119">19-Nov-2025</td>
            </tr>
            <tr data-lab="87.3, 3.2, -6.5" data-asin="B0BLYVTZSX">
                <td>Mika 3D</td>
                <td>Silk White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0BLYVTZSX?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">17.09</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="85.9, 0.1, -0.8" data-asin="B0BM7WZPXJ">
                <td>Elegoo</td>
                <td>White PLA Plus</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0BM7WZPXJ?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">14.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="85.7, -0.5, -0.8" data-asin="B0DCJRRJ49">
                <td>Deeplee</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0DCJRRJ49?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">11.99</a></td>
                <td data-date="20251119">19-Nov-2025</td>
            </tr>
            <tr data-lab="85.3, -1.4, -1.9" data-asin="B0B5GWJY2H">
                <td>Mika 3D</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B0B5GWJY2H?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">17.26</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="84.0, 0.7, -3.4">
                <td>Jayo</td>
                <td>PLA+ - White</td>
                <td class="color-cell"></td>
                <td><a href="https://jayo3d.com/collections/general-filaments/products/jayo-pla-3d-printing-filament-bundle-1-1kg-1"><img src="https://www.google.com/s2/favicons?domain=jayo3d.com&sz=32" alt="Amazon" class="favicon">9.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="83.4, -1.2, -1.7" data-asin="">
                <td>Prusament</td>
                <td>Pristine White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.prusa3d.com/product/prusament-pla-pristine-white-1kg/"><img src="https://www.google.com/s2/favicons?domain=prusa3d.com&sz=32" alt="Prusa3D" class="favicon">26.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <tr data-lab="83.2, 0.2, -5.1" data-asin="B00ME7E5X0">
                <td>3D Solutech</td>
                <td>Real White Premium PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B00ME7E5X0?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1"><img src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="Amazon" class="favicon">19.99</a></td>
                <td data-date="20251117">17-Nov-2025</td>
            </tr>
            <!-- tr data-lab="" data-asin="B099K1TCFM">
                <td>Polymaker</td>
                <td>White PLA</td>
                <td class="color-cell"></td>
                <td><a href="https://www.amazon.com/dp/B099K1TCFM?tag=mkoistinen-20&linkCode=ogi&th=1&psc=1">17.24</a></td>
                <td data-date=""></td>
            </tr -->
        </tbody>
    </table>
    <button class="add-color-btn" onclick="openAddColorModal()" aria-label="Add a personal color to the comparison">âž• Add Personal Color</button>
    </div>

    <footer>
        <small style="display: block; margin-top: 5px; opacity: 0.7;">
            All prices captured at date of adding the filament. Links to Amazon
            are affiliate links -- primarily so that I can eventually offer
            "live" prices as this requires a certain number of affiliate
            purchases before I can connect to the API to do so. Although this
            site costs me nothing to operate, I still have to buy all these
            filaments for physical color measurements, so, using the affiliate
            links will help me keep adding new filaments for
            everyone's benefit. ðŸ˜€
        </small>
    </footer>
    </section>
    </main>

    <!-- Add Color Modal -->
    <div id="addColorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add a Personal Color</h2>
            </div>
            <div class="modal-body">
                <p>
                    You are adding a "personal color". Personal colors are
                    stored in your browser's "Local Storage" and are only
                    visible to you (unless you share them). You may store as
                    many as you like (and your browser will support).
                </p>
                <p>
                    Personal colors can also be shared with others with the ðŸ”—
                    button after creation.
                </p>
                <div class="form-group">
                    <label for="colorName">Brand</label>
                    <input type="text" id="colorName" placeholder="" value="Personal color" />
                </div>
                <div class="form-group">
                    <label for="colorPolymer">Color Name/Polymer</label>
                    <input type="text" id="colorPolymer" placeholder="" />
                </div>
                <div class="form-group">
                    <label for="colorSpec">Specification</label>
                    <input type="text" id="colorSpec" placeholder="" />
                    <small style="display: block; margin-top: 5px; opacity: 0.7;">
                        Supported formats: LAB (e.g., "85.9, 0.1, -0.8"), RGB (e.g., "214, 215, 216"),
                        HSV (e.g., "210Â°, 1%, 85%" or "210, 1, 85"), Hex (e.g., "#D6D7D8")
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeAddColorModal()">Cancel</button>
                <button class="modal-btn primary" id="submitColorBtn" onclick="submitColor()" disabled>Submit</button>
            </div>
        </div>
    </div>

    <!-- Edit Color Modal -->
    <div id="editColorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Edit Personal Color</h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="editColorName">Brand</label>
                    <input type="text" id="editColorName" placeholder="" />
                </div>
                <div class="form-group">
                    <label for="editColorPolymer">Color Name/Polymer</label>
                    <input type="text" id="editColorPolymer" placeholder="" />
                </div>
                <div class="form-group">
                    <label for="editColorSpec">Specification</label>
                    <input type="text" id="editColorSpec" placeholder="" />
                    <small style="display: block; margin-top: 5px; opacity: 0.7;">
                        Supported formats: LAB (e.g., "85.9, 0.1, -0.8"), RGB (e.g., "214, 215, 216"),
                        HSV (e.g., "210Â°, 1%, 85%" or "210, 1, 85"), Hex (e.g., "#D6D7D8")
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn" onclick="closeEditColorModal()">Cancel</button>
                <button class="modal-btn danger" onclick="deleteColorFromEdit()">Delete</button>
                <button class="modal-btn primary" id="saveEditColorBtn" onclick="saveEditedColor()" disabled>Save</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="confirm-modal" role="dialog" aria-modal="true" aria-labelledby="deleteModalHeader">
        <div class="confirm-modal-content">
            <div class="confirm-modal-header" id="deleteModalHeader">
                Confirm Delete
            </div>
            <div class="confirm-modal-body" id="deleteModalBody">
                Are you sure you want to delete this personal color?
            </div>
            <div class="confirm-modal-footer">
                <button class="confirm-btn-cancel" onclick="closeDeleteConfirmation()" aria-describedby="deleteModalBody" autofocus>Cancel</button>
                <button class="confirm-btn-delete" onclick="confirmDelete()" aria-describedby="deleteModalBody">Delete</button>
            </div>
        </div>
    </div>

    <script>
        // Theme management
        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function getStoredTheme() {
            return localStorage.getItem('theme');
        }

        function setTheme(theme) {
            if (theme === 'auto') {
                const systemTheme = getSystemTheme();
                document.body.className = systemTheme === 'dark' ? 'dark-mode' : 'light-mode';
                updateThemeButton('auto', systemTheme);
            } else {
                document.body.className = theme === 'dark' ? 'dark-mode' : 'light-mode';
                updateThemeButton(theme, theme);
            }
            localStorage.setItem('theme', theme);
        }

        function updateThemeButton(storedTheme, actualTheme) {
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');

            if (storedTheme === 'auto') {
                icon.textContent = 'ðŸ”„';
                text.textContent = `Auto (${actualTheme === 'dark' ? 'Dark' : 'Light'})`;
            } else if (actualTheme === 'dark') {
                icon.textContent = 'â˜€ï¸';
                text.textContent = 'Switch to Light';
            } else {
                icon.textContent = 'ðŸŒ™';
                text.textContent = 'Switch to Dark';
            }
        }        function toggleTheme() {
            const currentStored = getStoredTheme() || 'auto';

            if (currentStored === 'auto') {
                setTheme('light');
            } else if (currentStored === 'light') {
                setTheme('dark');
            } else {
                setTheme('auto');
            }
        }

        // Initialize theme on page load
        const storedTheme = getStoredTheme() || 'auto';
        setTheme(storedTheme);

        // Listen for system theme changes when in auto mode
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (getStoredTheme() === 'auto' || !getStoredTheme()) {
                setTheme('auto');
            }
        });

        let currentColorMode = 'lab';
        let currentSort = { column: null, direction: 'asc' };

        // Utility functions
        function parseLAB(labString) {
            const parts = labString.split(',').map(s => parseFloat(s.trim()));
            return { L: parts[0], a: parts[1], b: parts[2] };
        }

        // LAB to XYZ conversion (D65 illuminant)
        function labToXYZ(L, a, b) {
            let y = (L + 16) / 116;
            let x = a / 500 + y;
            let z = y - b / 200;

            const fx = x > 0.206897 ? Math.pow(x, 3) : (x - 16/116) / 7.787;
            const fy = y > 0.206897 ? Math.pow(y, 3) : (y - 16/116) / 7.787;
            const fz = z > 0.206897 ? Math.pow(z, 3) : (z - 16/116) / 7.787;

            // D65 white point
            const X = fx * 95.047;
            const Y = fy * 100.000;
            const Z = fz * 108.883;

            return { X, Y, Z };
        }

        // XYZ to RGB conversion (sRGB color space)
        function xyzToRGB(X, Y, Z, clamp = true) {
            // Normalize XYZ
            const x = X / 100;
            const y = Y / 100;
            const z = Z / 100;

            // Convert to linear RGB
            let r_linear = x *  3.2406 + y * -1.5372 + z * -0.4986;
            let g_linear = x * -0.9689 + y *  1.8758 + z *  0.0415;
            let b_linear = x *  0.0557 + y * -0.2040 + z *  1.0570;

            // Apply gamma correction (handle negative values properly)
            const gamma = (c) => {
                if (c < 0) {
                    // Negative values can't be gamma corrected normally
                    return -1.055 * Math.pow(-c, 1/2.4) + 0.055;
                } else if (c > 0.0031308) {
                    return 1.055 * Math.pow(c, 1/2.4) - 0.055;
                } else {
                    return 12.92 * c;
                }
            };

            let r = gamma(r_linear);
            let g = gamma(g_linear);
            let b = gamma(b_linear);

            // Check if out of gamut BEFORE clamping
            const outOfGamut = r < 0 || r > 1 || g < 0 || g > 1 || b < 0 || b > 1;

            if (clamp) {
                // Clamp and convert to 0-255 range
                r = Math.max(0, Math.min(1, r)) * 255;
                g = Math.max(0, Math.min(1, g)) * 255;
                b = Math.max(0, Math.min(1, b)) * 255;

                return {
                    r: Math.round(r),
                    g: Math.round(g),
                    b: Math.round(b),
                    outOfGamut
                };
            } else {
                // Return unclamped values for dithering
                return {
                    r: r * 255,
                    g: g * 255,
                    b: b * 255,
                    outOfGamut
                };
            }
        }

        // Convert LAB to RGB
        function labToRGB(L, a, b) {
            const xyz = labToXYZ(L, a, b);
            return xyzToRGB(xyz.X, xyz.Y, xyz.Z);
        }

        // RGB to Hex conversion
        function rgbToHex(r, g, b) {
            const toHex = (n) => {
                const hex = n.toString(16);
                return hex.length === 1 ? '0' + hex : hex;
            };
            return '#' + toHex(r) + toHex(g) + toHex(b);
        }

        // RGB to HSV conversion
        function rgbToHSV(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;

            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            const delta = max - min;

            let h = 0;
            if (delta !== 0) {
                if (max === r) {
                    h = ((g - b) / delta) % 6;
                } else if (max === g) {
                    h = (b - r) / delta + 2;
                } else {
                    h = (r - g) / delta + 4;
                }
                h = Math.round(h * 60);
                if (h < 0) h += 360;
            }

            const s = max === 0 ? 0 : Math.round((delta / max) * 100);
            const v = Math.round(max * 100);

            return { h, s, v };
        }

        // Calculate relative luminance and determine if white or black text should be used
        function getContrastColor(r, g, b) {
            // Convert RGB to linear RGB
            const toLinear = (c) => {
                const normalized = c / 255;
                return normalized <= 0.03928
                    ? normalized / 12.92
                    : Math.pow((normalized + 0.055) / 1.055, 2.4);
            };

            // Calculate relative luminance using ITU-R BT.709 coefficients
            const luminance = 0.2126 * toLinear(r) + 0.7152 * toLinear(g) + 0.0722 * toLinear(b);

            // Use white text for dark backgrounds, black text for light backgrounds
            // Threshold of 0.5 works well for most cases
            return luminance > 0.5 ? '#000000' : '#ffffff';
        }

        // Dithering functions for out-of-gamut colors and sub-pixel accuracy
        function shouldDither(rgb) {
            // Dither if out of gamut
            if (rgb.outOfGamut) return true;

            // Dither if we have significant fractional components (sub-pixel accuracy)
            // Check if any channel has meaningful fractional part (> 0.1 difference from rounded)
            const rFrac = Math.abs(rgb.r - Math.round(rgb.r));
            const gFrac = Math.abs(rgb.g - Math.round(rgb.g));
            const bFrac = Math.abs(rgb.b - Math.round(rgb.b));

            // Use dithering if any channel has > 0.15 fractional component
            // (This threshold avoids dithering for tiny imperceptible differences)
            return rFrac > 0.15 || gFrac > 0.15 || bFrac > 0.15;
        }

        function createDitheredSwatch(lab, size = 24) {
            const canvas = document.createElement('canvas');
            canvas.width = canvas.height = size;
            canvas.className = 'color-swatch';
            canvas.style.display = 'inline-block';
            canvas.style.verticalAlign = 'middle';
            canvas.style.marginRight = '8px';

            // Get unclamped RGB values
            const xyz = labToXYZ(lab.L, lab.a, lab.b);
            const targetRGB = xyzToRGB(xyz.X, xyz.Y, xyz.Z, false);

            // Set tooltip based on reason for dithering
            if (targetRGB.outOfGamut) {
                canvas.title = 'Dithered: This color is outside the sRGB gamut';
            } else {
                canvas.title = 'Dithered: Sub-pixel accuracy for precise color representation';
            }

            const ctx = canvas.getContext('2d');
            const imageData = ctx.createImageData(size, size);

            // Create error diffusion buffer (Floyd-Steinberg dithering)
            const errors = Array(size).fill(null).map(() =>
                Array(size).fill(null).map(() => ({ r: 0, g: 0, b: 0 }))
            );

            for (let y = 0; y < size; y++) {
                for (let x = 0; x < size; x++) {
                    const idx = (y * size + x) * 4;

                    // Add accumulated error to target color
                    let r = targetRGB.r + errors[y][x].r;
                    let g = targetRGB.g + errors[y][x].g;
                    let b = targetRGB.b + errors[y][x].b;

                    // Clamp to valid range
                    const newR = Math.max(0, Math.min(255, Math.round(r)));
                    const newG = Math.max(0, Math.min(255, Math.round(g)));
                    const newB = Math.max(0, Math.min(255, Math.round(b)));

                    // Set pixel
                    imageData.data[idx] = newR;
                    imageData.data[idx + 1] = newG;
                    imageData.data[idx + 2] = newB;
                    imageData.data[idx + 3] = 255; // Alpha

                    // Calculate quantization error
                    const errR = r - newR;
                    const errG = g - newG;
                    const errB = b - newB;

                    // Distribute error to neighboring pixels (Floyd-Steinberg)
                    if (x + 1 < size) {
                        errors[y][x + 1].r += errR * 7/16;
                        errors[y][x + 1].g += errG * 7/16;
                        errors[y][x + 1].b += errB * 7/16;
                    }
                    if (y + 1 < size) {
                        if (x > 0) {
                            errors[y + 1][x - 1].r += errR * 3/16;
                            errors[y + 1][x - 1].g += errG * 3/16;
                            errors[y + 1][x - 1].b += errB * 3/16;
                        }
                        errors[y + 1][x].r += errR * 5/16;
                        errors[y + 1][x].g += errG * 5/16;
                        errors[y + 1][x].b += errB * 5/16;
                        if (x + 1 < size) {
                            errors[y + 1][x + 1].r += errR * 1/16;
                            errors[y + 1][x + 1].g += errG * 1/16;
                            errors[y + 1][x + 1].b += errB * 1/16;
                        }
                    }
                }
            }

            ctx.putImageData(imageData, 0, 0);
            return canvas;
        }

        // Update color cells based on current mode
        function updateColorCells() {
            const rows = document.querySelectorAll('#filamentTable tbody tr');

            rows.forEach(row => {
                const colorCell = row.querySelector('.color-cell');
                const labStr = row.dataset.lab;
                const lab = parseLAB(labStr);

                // Calculate RGB from LAB and check if out of gamut
                const rgb = labToRGB(lab.L, lab.a, lab.b);
                const hex = rgbToHex(rgb.r, rgb.g, rgb.b);

                let displayText = '';
                let swatchColor = hex;

                switch (currentColorMode) {
                    case 'lab':
                        displayText = labStr;
                        break;
                    case 'rgb':
                        displayText = `${rgb.r}, ${rgb.g}, ${rgb.b}`;
                        break;
                    case 'hsv':
                        const hsv = rgbToHSV(rgb.r, rgb.g, rgb.b);
                        displayText = `${hsv.h}Â°, ${hsv.s}%, ${hsv.v}%`;
                        break;
                    case 'hex':
                        displayText = hex.toUpperCase();
                        break;
                }

                // Clear the cell first
                colorCell.innerHTML = '';

                // Get unclamped RGB for dithering decision
                const xyz = labToXYZ(lab.L, lab.a, lab.b);
                const unclampedRGB = xyzToRGB(xyz.X, xyz.Y, xyz.Z, false);

                // Use dithered canvas if we should dither (out of gamut OR sub-pixel accuracy)
                if (shouldDither(unclampedRGB)) {
                    const canvas = createDitheredSwatch(lab);
                    colorCell.appendChild(canvas);

                    // Add a subtle indicator that dithering is active
                    const indicator = document.createElement('span');
                    indicator.style.opacity = '0.4';
                    indicator.style.fontSize = '0.8em';
                    indicator.title = unclampedRGB.outOfGamut
                        ? 'Dithered swatch (out of gamut)'
                        : 'Dithered swatch (sub-pixel accuracy)';
                    colorCell.appendChild(indicator);

                    const textNode = document.createTextNode(displayText);
                    colorCell.appendChild(textNode);
                } else {
                    colorCell.innerHTML = `<span class="color-swatch" style="background-color:${swatchColor}"></span>${displayText}`;
                }

                // Add edit and share buttons for user colors
                const isUserColor = row.dataset.userColor === 'true';
                if (isUserColor) {
                    const editBtn = document.createElement('button');
                    editBtn.className = 'edit-icon';
                    editBtn.textContent = 'âœŽ';
                    editBtn.title = 'Edit personal color';
                    editBtn.setAttribute('aria-label', 'Edit personal color');
                    editBtn.setAttribute('role', 'button');
                    editBtn.onclick = function() { openEditColorModal(this); };
                    colorCell.appendChild(editBtn);

                    const shareBtn = document.createElement('button');
                    shareBtn.className = 'share-icon';
                    shareBtn.textContent = 'ðŸ”—';
                    shareBtn.title = 'Share color (copy URL to clipboard)';
                    shareBtn.setAttribute('aria-label', 'Share color');
                    shareBtn.setAttribute('role', 'button');
                    shareBtn.onclick = function() { shareColor(this); };
                    colorCell.appendChild(shareBtn);
                }

                // Add copy button
                const copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'ðŸ“‹';
                copyBtn.title = 'Copy color value to clipboard';
                copyBtn.setAttribute('data-color-value', displayText);
                colorCell.appendChild(copyBtn);
            });
        }

        // Sorting function
        function sortTable(column) {
            const table = document.getElementById('filamentTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            // Determine sort direction
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            rows.sort((a, b) => {
                let aValue, bValue;

                if (column === 'brand') {
                    aValue = a.cells[0].textContent.trim();
                    bValue = b.cells[0].textContent.trim();
                    return currentSort.direction === 'asc'
                        ? aValue.localeCompare(bValue)
                        : bValue.localeCompare(aValue);
                } else if (column === 'polymer') {
                    aValue = a.cells[1].textContent.trim();
                    bValue = b.cells[1].textContent.trim();
                    return currentSort.direction === 'asc'
                        ? aValue.localeCompare(bValue)
                        : bValue.localeCompare(aValue);
                } else if (column === 'color') {
                    // Sort by LAB lightness (first value)
                    const aLab = parseLAB(a.dataset.lab);
                    const bLab = parseLAB(b.dataset.lab);

                    // Clear all sort button active states first
                    document.querySelectorAll('.color-mode-btn[data-sort]').forEach(b => b.classList.remove('active'));

                    // Sync with lightness button state
                    sortStates.lightness = currentSort.direction;
                    const lightnessBtn = document.querySelector('.color-mode-btn[data-sort="lightness"]');
                    if (lightnessBtn) {
                        updateSortButtonText(lightnessBtn, 'lightness');
                        lightnessBtn.classList.add('active');
                    }

                    return currentSort.direction === 'asc'
                        ? aLab.L - bLab.L
                        : bLab.L - aLab.L;
                } else if (column === 'date') {
                    // Sort by date using data-date attribute (YYYYMMDD format)
                    const aDateCell = a.cells[4];
                    const bDateCell = b.cells[4];
                    aValue = parseInt(aDateCell.dataset.date || '0');
                    bValue = parseInt(bDateCell.dataset.date || '0');
                    return currentSort.direction === 'asc'
                        ? aValue - bValue
                        : bValue - aValue;
                } else if (column === 'cost') {
                    // Sort by cost (numeric) - extract number from text content
                    const aCostText = a.cells[3].textContent.trim();
                    const bCostText = b.cells[3].textContent.trim();
                    // Use regex to extract the numeric value (handles cases with favicon alt text)
                    aValue = parseFloat(aCostText.match(/[\d.]+/)?.[0] || '0');
                    bValue = parseFloat(bCostText.match(/[\d.]+/)?.[0] || '0');
                    return currentSort.direction === 'asc'
                        ? aValue - bValue
                        : bValue - aValue;
                }
            });

            // Re-append rows in sorted order
            rows.forEach(row => tbody.appendChild(row));

            // Update header indicators
            updateSortIndicators(column);

            // Clear other sort button active states when clicking column headers
            if (column !== 'color') {
                document.querySelectorAll('.color-mode-btn[data-sort]').forEach(b => b.classList.remove('active'));
            }
        }

        function updateSortIndicators(activeColumn) {
            const headers = document.querySelectorAll('th[data-sort]');
            headers.forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                if (th.dataset.sort === activeColumn) {
                    th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });
        }

        // Event listeners
        document.querySelectorAll('.color-mode-btn[data-mode]').forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active button (only for color format buttons)
                document.querySelectorAll('.color-mode-btn[data-mode]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Update color mode
                currentColorMode = btn.dataset.mode;
                updateColorCells();
            });
        });

        document.querySelectorAll('th[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                sortTable(th.dataset.sort);
            });
        });


        // Track sort state for toggle buttons
        let sortStates = {
            lightness: 'desc',  // Start with high to low (â†“)
            hue: 'asc',         // Start with green to red (â†‘)
            warmth: 'asc',      // Start with cool to warm (â†‘)
            strength: 'asc'     // Start with least to most (â†‘)
        };

        // Tint sort buttons
        document.querySelectorAll('.color-mode-btn[data-sort]').forEach(btn => {
            btn.addEventListener('click', () => {
                const sortType = btn.dataset.sort;

                // Toggle the direction
                sortStates[sortType] = sortStates[sortType] === 'asc' ? 'desc' : 'asc';

                // Update button text
                updateSortButtonText(btn, sortType);

                // Remove active state from all sort buttons first
                document.querySelectorAll('.color-mode-btn[data-sort]').forEach(b => b.classList.remove('active'));
                // Add active state to clicked button
                btn.classList.add('active');

                // Perform sort
                sortByAttribute(sortType, sortStates[sortType]);
            });
        });

        function updateSortButtonText(btn, sortType) {
            const direction = sortStates[sortType];

            if (sortType === 'lightness') {
                btn.textContent = direction === 'desc' ? 'Lightness â†“' : 'Lightness â†‘';
            } else if (sortType === 'hue') {
                btn.textContent = direction === 'asc' ? 'Tint Hue â†‘' : 'Tint Hue â†“';
            } else if (sortType === 'warmth') {
                btn.textContent = direction === 'asc' ? 'Tint Warmth â†‘' : 'Tint Warmth â†“';
            } else if (sortType === 'strength') {
                btn.textContent = direction === 'asc' ? 'Tint Strength â†‘' : 'Tint Strength â†“';
            }
        }

        // Sort by attribute
        function sortByAttribute(sortType, direction) {
            const table = document.getElementById('filamentTable');
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));

            rows.sort((a, b) => {
                const aLab = parseLAB(a.dataset.lab);
                const bLab = parseLAB(b.dataset.lab);

                let comparison = 0;

                if (sortType === 'lightness') {
                    // Sort by L value (lightness)
                    comparison = aLab.L - bLab.L;
                } else if (sortType === 'hue') {
                    // Sort by a value (green-red axis)
                    comparison = aLab.a - bLab.a;
                } else if (sortType === 'warmth') {
                    // Sort by b value (blue-yellow axis)
                    comparison = aLab.b - bLab.b;
                } else if (sortType === 'strength') {
                    // Sort by tint intensity (chroma/saturation)
                    const aChroma = Math.sqrt(aLab.a * aLab.a + aLab.b * aLab.b);
                    const bChroma = Math.sqrt(bLab.a * bLab.a + bLab.b * bLab.b);
                    comparison = aChroma - bChroma;
                }

                return direction === 'asc' ? comparison : -comparison;
            });

            // Re-append rows in sorted order
            rows.forEach(row => tbody.appendChild(row));

            // Update Color column header indicator when using attribute sorts
            const headers = document.querySelectorAll('th[data-sort]');
            headers.forEach(th => th.classList.remove('sorted-asc', 'sorted-desc'));

            const colorHeader = document.querySelector('th[data-sort="color"]');
            if (colorHeader) {
                colorHeader.classList.add(direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
            }

            // Update current sort state to match
            currentSort = { column: 'color', direction: direction };
        }

        // Hover effect for color comparison
        function setupColorComparisonHover() {
            const rows = document.querySelectorAll('#filamentTable tbody tr');
            const allColorCells = document.querySelectorAll('.color-cell');
            let currentlyActiveRow = null;

            function applyColorBackground(row) {
                const labStr = row.dataset.lab;
                if (!labStr) return;

                const lab = parseLAB(labStr);
                const rgb = labToRGB(lab.L, lab.a, lab.b);
                const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
                const textColor = getContrastColor(rgb.r, rgb.g, rgb.b);

                // Check if we should use dithering
                const unclampedRGB = xyzToRGB(labToXYZ(lab.L, lab.a, lab.b).X,
                                               labToXYZ(lab.L, lab.a, lab.b).Y,
                                               labToXYZ(lab.L, lab.a, lab.b).Z, false);
                const useDithering = shouldDither(unclampedRGB);

                if (useDithering) {
                    // Create a large dithered canvas for backgrounds
                    const canvas = createDitheredSwatch(lab, 4); // 4x4 pixel pattern
                    const pattern = canvas.toDataURL();

                    // Apply the dithered pattern as background to all color cells
                    allColorCells.forEach(cell => {
                        cell.style.backgroundColor = '';
                        cell.style.backgroundImage = `url(${pattern})`;
                        cell.style.backgroundRepeat = 'repeat';
                        cell.style.backgroundSize = '4px 4px';
                        cell.style.color = textColor;
                    });

                    // Also paint the entire hovered/tapped row with the dithered pattern
                    Array.from(row.cells).forEach(cell => {
                        cell.style.backgroundColor = '';
                        cell.style.backgroundImage = `url(${pattern})`;
                        cell.style.backgroundRepeat = 'repeat';
                        cell.style.backgroundSize = '4px 4px';
                        cell.style.color = textColor;
                    });
                } else {
                    // Use solid color for in-gamut colors
                    // Apply the color as background to all color cells
                    allColorCells.forEach(cell => {
                        cell.style.backgroundColor = hex;
                        cell.style.backgroundImage = '';
                        cell.style.color = textColor;
                    });

                    // Also paint the entire hovered/tapped row with its color
                    Array.from(row.cells).forEach(cell => {
                        cell.style.backgroundColor = hex;
                        cell.style.backgroundImage = '';
                        cell.style.color = textColor;
                    });
                }
            }

            function clearColorBackground() {
                // Clear backgrounds on all color cells
                allColorCells.forEach(cell => {
                    cell.style.backgroundColor = '';
                    cell.style.backgroundImage = '';
                    cell.style.color = ''; // Reset to default text color
                });

                // Clear all row backgrounds and selected class
                rows.forEach(row => {
                    Array.from(row.cells).forEach(cell => {
                        cell.style.backgroundColor = '';
                        cell.style.backgroundImage = '';
                        cell.style.color = '';
                    });
                    row.classList.remove('selected');
                });

                currentlyActiveRow = null;
            }            rows.forEach(row => {
                // Mouse events (desktop)
                row.addEventListener('mouseenter', function() {
                    applyColorBackground(this);
                });

                row.addEventListener('mouseleave', function() {
                    clearColorBackground();
                });

                // Touch events (mobile/tablet)
                row.addEventListener('touchstart', function(e) {
                    // If tapping the same row, toggle off
                    if (currentlyActiveRow === this) {
                        clearColorBackground();
                    } else {
                        // Clear previous selection first
                        clearColorBackground();
                        // Then apply new color and add selected class
                        currentlyActiveRow = this;
                        this.classList.add('selected');
                        applyColorBackground(this);
                    }
                    // Don't prevent default - allow scrolling and other interactions
                }, { passive: true });
            });

            // Clear on tap outside the table
            document.addEventListener('touchstart', function(e) {
                const table = document.getElementById('filamentTable');
                if (table && !table.contains(e.target) && currentlyActiveRow) {
                    clearColorBackground();
                }
            }, { passive: true });
        }

        // Initialize
        updateColorCells();
        setupColorComparisonHover();

        // Copy button functionality
        function setupCopyButtons() {
            document.getElementById('filamentTable').addEventListener('click', function(e) {
                if (e.target.classList.contains('copy-btn')) {
                    const colorValue = e.target.getAttribute('data-color-value');

                    // Copy to clipboard
                    navigator.clipboard.writeText(colorValue).then(() => {
                        // Visual feedback
                        const originalText = e.target.textContent;
                        e.target.textContent = 'âœ“';
                        e.target.style.background = 'var(--button-active-bg)';
                        e.target.style.color = 'var(--button-active-color)';

                        setTimeout(() => {
                            e.target.textContent = originalText;
                            e.target.style.background = '';
                            e.target.style.color = '';
                        }, 1000);
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        // Fallback visual feedback for error
                        const originalText = e.target.textContent;
                        e.target.textContent = 'âœ—';
                        e.target.title = 'Copy failed. Clipboard access requires HTTPS or localhost.';
                        setTimeout(() => {
                            e.target.textContent = originalText;
                            e.target.title = 'Copy color value to clipboard';
                        }, 2000);
                    });

                    // Prevent event from bubbling to row click handlers
                    e.stopPropagation();
                }
            });
        }

        setupCopyButtons();

        // Set initial sort state to reflect natural descending brightness order
        currentSort = { column: 'color', direction: 'desc' };
        const colorHeader = document.querySelector('th[data-sort="color"]');
        if (colorHeader) {
            colorHeader.classList.add('sorted-desc');
        }
        const lightnessBtn = document.querySelector('.color-mode-btn[data-sort="lightness"]');
        if (lightnessBtn) {
            lightnessBtn.classList.add('active');
        }

        // ===== User Color Management =====

        // CSS named colors for placeholder examples
        // Note: JavaScript doesn't provide an API to enumerate CSS named colors,
        // so we maintain this curated list. Hex values are generated dynamically.
        const CSS_COLOR_NAMES = [
            'AliceBlue', 'AntiqueWhite', 'Aqua', 'Azure', 'Beige', 'Bisque',
            'BlanchedAlmond', 'Coral', 'Cornsilk', 'Crimson', 'Cyan',
            'DarkGoldenRod', 'DarkKhaki', 'DarkSalmon', 'FloralWhite',
            'Gainsboro', 'GhostWhite', 'Gold', 'Honeydew', 'Ivory',
            'Lavender', 'LavenderBlush', 'LemonChiffon', 'LightCyan',
            'LightGoldenRodYellow', 'LightGray', 'LightPink', 'LightSalmon',
            'LightYellow', 'Linen', 'MintCream', 'MistyRose', 'Moccasin',
            'NavajoWhite', 'OldLace', 'PapayaWhip', 'PeachPuff', 'Pink',
            'Plum', 'PowderBlue', 'RosyBrown', 'SeaShell', 'Silver',
            'Snow', 'Thistle', 'Wheat', 'White', 'WhiteSmoke'
        ];

        // Convert CSS color name to hex dynamically
        function colorNameToHex(colorName) {
            const ctx = document.createElement('canvas').getContext('2d');
            ctx.fillStyle = colorName;
            return ctx.fillStyle;
        }

        // Get random CSS color for placeholder
        function getRandomCSSColor() {
            const name = CSS_COLOR_NAMES[Math.floor(Math.random() * CSS_COLOR_NAMES.length)];
            return { name, spec: colorNameToHex(name) };
        }

        // Color parsing and conversion functions
        function parseColorSpec(spec) {
            spec = spec.trim();

            // Try HEX format (#RRGGBB)
            if (spec.match(/^#[0-9A-Fa-f]{6}$/)) {
                return hexToLAB(spec);
            }

            // Try to parse comma-separated values
            const parts = spec.split(',').map(s => s.trim());

            if (parts.length === 3) {
                const nums = parts.map(p => {
                    // Remove degree symbol if present
                    p = p.replace('Â°', '');
                    // Remove percentage symbol if present
                    p = p.replace('%', '');
                    return parseFloat(p);
                });

                // Check if all values are valid numbers
                if (nums.every(n => !isNaN(n))) {
                    // Determine format based on value ranges
                    // LAB: L in [0,100], a and b typically in [-128, 127]
                    // RGB: all in [0, 255]
                    // HSV: H in [0, 360], S and V in [0, 100]

                    const [v1, v2, v3] = nums;

                    // Constants for color format ranges
                    const LAB_L_MAX = 100;
                    const RGB_MAX = 255;
                    const HSV_H_MAX = 360;
                    const HSV_SV_MAX = 100;

                    // Check for HSV (H: 0-360, S: 0-100, V: 0-100)
                    // HSV has distinct ranges, check this first
                    if (v1 > LAB_L_MAX && v1 <= HSV_H_MAX && v2 >= 0 && v2 <= HSV_SV_MAX && v3 >= 0 && v3 <= HSV_SV_MAX) {
                        return hsvToLAB(v1, v2, v3);
                    }

                    // Check for degree symbol which indicates HSV
                    if (spec.includes('Â°')) {
                        if (v1 >= 0 && v1 <= HSV_H_MAX && v2 >= 0 && v2 <= HSV_SV_MAX && v3 >= 0 && v3 <= HSV_SV_MAX) {
                            return hsvToLAB(v1, v2, v3);
                        }
                    }

                    // Check for RGB (all values 0-255, and all are integers in that range)
                    if (v1 >= 0 && v1 <= RGB_MAX && v2 >= 0 && v2 <= RGB_MAX && v3 >= 0 && v3 <= RGB_MAX &&
                        Number.isInteger(parseFloat(parts[0])) &&
                        Number.isInteger(parseFloat(parts[1])) &&
                        Number.isInteger(parseFloat(parts[2]))) {
                        return rgbToLABConversion(v1, v2, v3);
                    }

                    // Default to LAB format if first value is in L range
                    if (v1 >= 0 && v1 <= LAB_L_MAX) {
                        return { L: v1, a: v2, b: v3 };
                    }
                }
            }

            return null;
        }

        // Hex to LAB conversion
        function hexToLAB(hex) {
            const r = parseInt(hex.substring(1, 3), 16);
            const g = parseInt(hex.substring(3, 5), 16);
            const b = parseInt(hex.substring(5, 7), 16);
            return rgbToLABConversion(r, g, b);
        }

        // RGB to LAB conversion
        function rgbToLABConversion(r, g, b) {
            // Convert RGB to XYZ
            let rLinear = r / 255;
            let gLinear = g / 255;
            let bLinear = b / 255;

            // Inverse gamma correction
            const invGamma = (c) => {
                if (c > 0.04045) {
                    return Math.pow((c + 0.055) / 1.055, 2.4);
                } else {
                    return c / 12.92;
                }
            };

            rLinear = invGamma(rLinear);
            gLinear = invGamma(gLinear);
            bLinear = invGamma(bLinear);

            // Convert to XYZ (D65 illuminant)
            const x = (rLinear * 0.4124564 + gLinear * 0.3575761 + bLinear * 0.1804375) * 100;
            const y = (rLinear * 0.2126729 + gLinear * 0.7151522 + bLinear * 0.0721750) * 100;
            const z = (rLinear * 0.0193339 + gLinear * 0.1191920 + bLinear * 0.9503041) * 100;

            // Convert XYZ to LAB
            return xyzToLAB(x, y, z);
        }

        // XYZ to LAB conversion
        function xyzToLAB(x, y, z) {
            // D65 white point
            const xn = 95.047;
            const yn = 100.000;
            const zn = 108.883;

            const fx = x / xn;
            const fy = y / yn;
            const fz = z / zn;

            const labF = (t) => {
                const delta = 6/29;
                if (t > Math.pow(delta, 3)) {
                    return Math.pow(t, 1/3);
                } else {
                    return t / (3 * delta * delta) + 4/29;
                }
            };

            const L = 116 * labF(fy) - 16;
            const a = 500 * (labF(fx) - labF(fy));
            const b = 200 * (labF(fy) - labF(fz));

            return { L, a, b };
        }

        // HSV to LAB conversion
        function hsvToLAB(h, s, v) {
            // Convert HSV to RGB first
            s = s / 100;
            v = v / 100;

            const c = v * s;
            const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
            const m = v - c;

            let r, g, b;
            if (h >= 0 && h < 60) {
                [r, g, b] = [c, x, 0];
            } else if (h >= 60 && h < 120) {
                [r, g, b] = [x, c, 0];
            } else if (h >= 120 && h < 180) {
                [r, g, b] = [0, c, x];
            } else if (h >= 180 && h < 240) {
                [r, g, b] = [0, x, c];
            } else if (h >= 240 && h < 300) {
                [r, g, b] = [x, 0, c];
            } else {
                [r, g, b] = [c, 0, x];
            }

            r = Math.round((r + m) * 255);
            g = Math.round((g + m) * 255);
            b = Math.round((b + m) * 255);

            return rgbToLABConversion(r, g, b);
        }

        // Modal functions
        function openAddColorModal() {
            const modal = document.getElementById('addColorModal');
            const nameInput = document.getElementById('colorName');
            const polymerInput = document.getElementById('colorPolymer');
            const specInput = document.getElementById('colorSpec');
            const submitBtn = document.getElementById('submitColorBtn');

            // Get random CSS color for placeholders
            const randomColor = getRandomCSSColor();
            polymerInput.placeholder = randomColor.name;
            specInput.placeholder = randomColor.spec;

            // Clear inputs (except Brand which defaults to "Personal color")
            polymerInput.value = '';
            specInput.value = '';
            submitBtn.disabled = true;

            modal.style.display = 'block';

            // Focus on polymer input
            polymerInput.focus();
        }

        function closeAddColorModal() {
            const modal = document.getElementById('addColorModal');
            modal.style.display = 'none';
        }

        // Edit Color Modal functions
        let editingRow = null;
        let originalEditValues = {};

        function openEditColorModal(btn) {
            editingRow = btn.closest('tr');
            const modal = document.getElementById('editColorModal');
            const nameInput = document.getElementById('editColorName');
            const polymerInput = document.getElementById('editColorPolymer');
            const specInput = document.getElementById('editColorSpec');
            const saveBtn = document.getElementById('saveEditColorBtn');

            // Get current values from the row
            const brandName = editingRow.cells[0].textContent.trim();
            const polymerName = getPolymerTextFromCell(editingRow.cells[1]);
            const labStr = editingRow.dataset.lab;

            // Store original values for change detection
            originalEditValues = {
                brand: brandName,
                polymer: polymerName,
                lab: labStr
            };

            // Populate inputs
            nameInput.value = brandName;
            polymerInput.value = polymerName;
            specInput.value = labStr;

            saveBtn.disabled = true;

            modal.style.display = 'block';

            // Focus on brand input
            nameInput.focus();
        }

        function closeEditColorModal() {
            const modal = document.getElementById('editColorModal');
            modal.style.display = 'none';
            editingRow = null;
            originalEditValues = {};
        }

        function validateEditColor() {
            const nameInput = document.getElementById('editColorName');
            const polymerInput = document.getElementById('editColorPolymer');
            const specInput = document.getElementById('editColorSpec');
            const saveBtn = document.getElementById('saveEditColorBtn');

            const brand = nameInput.value.trim();
            const polymer = polymerInput.value.trim();
            const spec = specInput.value.trim();

            // Check if spec is valid
            if (!spec) {
                saveBtn.disabled = true;
                return;
            }

            const lab = parseColorSpec(spec);
            if (!lab) {
                saveBtn.disabled = true;
                return;
            }

            // Check if anything changed
            const labStr = `${lab.L.toFixed(1)}, ${lab.a.toFixed(1)}, ${lab.b.toFixed(1)}`;
            const hasChanged = brand !== originalEditValues.brand ||
                               polymer !== originalEditValues.polymer ||
                               labStr !== originalEditValues.lab;

            saveBtn.disabled = !hasChanged;
        }

        function saveEditedColor() {
            if (!editingRow) return;

            const nameInput = document.getElementById('editColorName');
            const polymerInput = document.getElementById('editColorPolymer');
            const specInput = document.getElementById('editColorSpec');

            const brand = nameInput.value.trim();
            const polymer = polymerInput.value.trim();
            const spec = specInput.value.trim();

            const lab = parseColorSpec(spec);

            if (!lab) {
                alert('Invalid color specification. Please use one of these formats:\n' +
                      'â€¢ LAB: "85.9, 0.1, -0.8"\n' +
                      'â€¢ RGB: "214, 215, 216"\n' +
                      'â€¢ HSV: "210Â°, 1%, 85%" or "210, 1, 85"\n' +
                      'â€¢ Hex: "#D6D7D8"');
                return;
            }

            // Update the row
            const labStr = `${lab.L.toFixed(1)}, ${lab.a.toFixed(1)}, ${lab.b.toFixed(1)}`;
            editingRow.dataset.lab = labStr;
            editingRow.cells[0].textContent = brand;
            editingRow.cells[1].textContent = polymer;

            // Save to localStorage
            saveUserColors();

            // Update color cells to reflect changes
            updateColorCells();

            // Re-setup hover effect
            setupColorComparisonHover();

            // Close modal
            closeEditColorModal();
        }

        function deleteColorFromEdit() {
            if (editingRow) {
                const rowToDelete = editingRow;  // Store reference before closing
                closeEditColorModal();
                showDeleteConfirmation(rowToDelete);
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const addModal = document.getElementById('addColorModal');
            const editModal = document.getElementById('editColorModal');
            const deleteModal = document.getElementById('deleteConfirmModal');

            if (event.target === addModal) {
                closeAddColorModal();
            } else if (event.target === editModal) {
                closeEditColorModal();
            } else if (event.target === deleteModal) {
                closeDeleteConfirmation();
            }
        });

        // Close modals with Escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' || event.key === 'Esc') {
                const addModal = document.getElementById('addColorModal');
                const editModal = document.getElementById('editColorModal');
                const deleteModal = document.getElementById('deleteConfirmModal');

                if (addModal && addModal.style.display === 'block') {
                    closeAddColorModal();
                } else if (editModal && editModal.style.display === 'block') {
                    closeEditColorModal();
                } else if (deleteModal && deleteModal.style.display === 'block') {
                    closeDeleteConfirmation();
                }
            }
        });

        // Validate color and enable/disable submit button
        function validateColor() {
            const specInput = document.getElementById('colorSpec');
            const submitBtn = document.getElementById('submitColorBtn');
            const spec = specInput.value.trim();

            if (!spec) {
                submitBtn.disabled = true;
                return;
            }

            const lab = parseColorSpec(spec);
            submitBtn.disabled = !lab;
        }

        // Add event listener for color spec input
        document.addEventListener('DOMContentLoaded', function() {
            const specInput = document.getElementById('colorSpec');
            if (specInput) {
                specInput.addEventListener('input', validateColor);
            }

            // Add event listeners for edit modal inputs
            const editNameInput = document.getElementById('editColorName');
            const editPolymerInput = document.getElementById('editColorPolymer');
            const editSpecInput = document.getElementById('editColorSpec');
            if (editNameInput && editPolymerInput && editSpecInput) {
                editNameInput.addEventListener('input', validateEditColor);
                editPolymerInput.addEventListener('input', validateEditColor);
                editSpecInput.addEventListener('input', validateEditColor);
            }
        });

        // Submit color
        function submitColor() {
            const nameInput = document.getElementById('colorName');
            const polymerInput = document.getElementById('colorPolymer');
            const specInput = document.getElementById('colorSpec');

            const name = nameInput.value.trim();
            const polymer = polymerInput.value.trim() || polymerInput.placeholder;
            const spec = specInput.value.trim();

            const lab = parseColorSpec(spec);

            if (!lab) {
                alert('Invalid color specification. Please use one of these formats:\n' +
                      'â€¢ LAB: "85.9, 0.1, -0.8"\n' +
                      'â€¢ RGB: "214, 215, 216"\n' +
                      'â€¢ HSV: "210Â°, 1%, 85%" or "210, 1, 85"\n' +
                      'â€¢ Hex: "#D6D7D8"');
                return;
            }

            // Add color to table
            addUserColor(name, polymer, lab);

            // Close modal
            closeAddColorModal();
        }

        // Utility function to extract polymer text from cell (excluding buttons)
        function getPolymerTextFromCell(cell) {
            const clonedCell = cell.cloneNode(true);
            const buttons = clonedCell.querySelectorAll('button');
            buttons.forEach(button => button.remove());
            return clonedCell.textContent.trim();
        }

        // Load user colors from localStorage
        function loadUserColors() {
            try {
                const stored = localStorage.getItem('userColors');
                if (stored) {
                    const userColors = JSON.parse(stored);
                    userColors.forEach(color => {
                        // Parse LAB string to object if needed
                        let lab = color.lab;
                        if (typeof lab === 'string') {
                            lab = parseLAB(lab);
                        }

                        // Support both new format (brand + polymer) and legacy format (name only)
                        if (color.brand && color.polymer) {
                            addUserColorRow(color.brand, color.polymer, lab, false, color.dateAdded);
                        } else if (color.name) {
                            // Legacy format
                            addUserColorRow(color.name, 'Personal color', lab, false, color.dateAdded);
                        }
                    });
                    // Sort table by Lightness using the initial sort state after loading all custom colors
                    sortByAttribute('lightness', sortStates.lightness);
                }
            } catch (e) {
                console.error('Error loading user colors:', e);
            }
        }

        // Save user colors to localStorage
        function saveUserColors() {
            try {
                const rows = document.querySelectorAll('#filamentTable tbody tr[data-user-color="true"]');
                const userColors = Array.from(rows).map(row => {
                    const dateCell = row.cells[4];
                    const brandCell = row.cells[0];
                    const polymerText = getPolymerTextFromCell(row.cells[1]);

                    return {
                        brand: brandCell.textContent.trim(),
                        polymer: polymerText,
                        lab: row.dataset.lab,
                        dateAdded: dateCell.dataset.date
                    };
                });
                localStorage.setItem('userColors', JSON.stringify(userColors));
            } catch (e) {
                console.error('Error saving user colors:', e);
            }
        }

        // Add user color
        function addUserColor(name, polymer, lab) {
            addUserColorRow(name, polymer, lab, true);
            saveUserColors();
        }

        // Add user color row to table
        function addUserColorRow(brandName, polymerName, lab, shouldSort = true, dateAdded = null) {
            const table = document.getElementById('filamentTable');
            const tbody = table.querySelector('tbody');

            const row = document.createElement('tr');
            row.dataset.lab = `${lab.L.toFixed(1)}, ${lab.a.toFixed(1)}, ${lab.b.toFixed(1)}`;
            row.dataset.userColor = 'true';

            // Use provided date or get today's date in YYYYMMDD format
            let dateStr, displayDate;
            if (dateAdded) {
                // Use the saved date
                dateStr = dateAdded;
                // Convert YYYYMMDD to display format
                const year = dateStr.substring(0, 4);
                const month = parseInt(dateStr.substring(4, 6)) - 1;
                const day = dateStr.substring(6, 8);
                displayDate = day + '-' +
                            ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][month] + '-' +
                            year;
            } else {
                // Create new date for newly added color
                const today = new Date();
                dateStr = today.getFullYear() +
                          String(today.getMonth() + 1).padStart(2, '0') +
                          String(today.getDate()).padStart(2, '0');
                displayDate = String(today.getDate()).padStart(2, '0') + '-' +
                              ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'][today.getMonth()] + '-' +
                              today.getFullYear();
            }

            row.innerHTML = `
                <td>${brandName}</td>
                <td>${polymerName}</td>
                <td class="color-cell"></td>
                <td></td>
                <td data-date="${dateStr}">${displayDate}</td>
            `;

            tbody.appendChild(row);

            // Update the color cell
            updateColorCells();

            // Re-setup hover effect for the new row
            setupColorComparisonHover();

            // Sort table if requested
            if (shouldSort) {
                // Use sortByAttribute to maintain the current sort direction without toggling
                sortByAttribute('lightness', sortStates.lightness);
            }
        }

        // Share color - copy URL to clipboard
        function shareColor(btn) {
            const row = btn.closest('tr');

            // Extract brand and polymer from the row
            const brandName = row.cells[0].textContent.trim();
            const polymerName = getPolymerTextFromCell(row.cells[1]);

            // Get LAB values from the row
            const labStr = row.dataset.lab;

            // Validate LAB data exists
            if (!labStr) {
                console.error('No LAB data found for this color');
                alert('Unable to share: Color specification data is missing.');
                return;
            }

            // Get current page URL without query parameters
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?brand=${encodeURIComponent(brandName)}&polymer=${encodeURIComponent(polymerName)}&lab=${encodeURIComponent(labStr)}`;

            // Check if clipboard API is available
            if (!navigator.clipboard || !navigator.clipboard.writeText) {
                // Fallback: show URL in alert for manual copy
                const originalText = btn.textContent;
                btn.textContent = 'â„¹ï¸';
                alert('Share this URL:\n\n' + shareUrl);
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 1000);
                return;
            }

            // Copy to clipboard
            navigator.clipboard.writeText(shareUrl).then(() => {
                // Visual feedback
                const originalText = btn.textContent;
                btn.textContent = 'âœ“';
                btn.style.background = 'var(--button-active-bg)';
                btn.style.color = 'var(--button-active-color)';

                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy share URL:', err);
                // Fallback visual feedback for error
                const originalText = btn.textContent;
                btn.textContent = 'âœ—';
                btn.title = 'Copy failed. Please try again or copy the URL manually.';
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.title = 'Share color (copy URL to clipboard)';
                }, 2000);
            });
        }

        // Delete user color - show confirmation modal
        let rowToDelete = null;

        function showDeleteConfirmation(btnOrRow) {
            // Accept either a button element or a row element
            if (btnOrRow.tagName === 'TR') {
                rowToDelete = btnOrRow;
            } else {
                rowToDelete = btnOrRow.closest('tr');
            }
            const modal = document.getElementById('deleteConfirmModal');
            modal.style.display = 'block';
        }

        function closeDeleteConfirmation() {
            const modal = document.getElementById('deleteConfirmModal');
            modal.style.display = 'none';
            rowToDelete = null;
        }

        function confirmDelete() {
            if (rowToDelete) {
                rowToDelete.remove();
                saveUserColors();
                closeDeleteConfirmation();
            }
        }

        // Load user colors on page load
        loadUserColors();

        // Utility function to validate LAB color values
        function isValidLab(lab) {
            return lab &&
                   typeof lab.L === 'number' && !isNaN(lab.L) &&
                   typeof lab.a === 'number' && !isNaN(lab.a) &&
                   typeof lab.b === 'number' && !isNaN(lab.b);
        }

        // Check for shared color in URL parameters
        function loadSharedColor() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const brandName = urlParams.get('brand');
                const polymerName = urlParams.get('polymer');
                const labStr = urlParams.get('lab');

                // Support legacy color-name parameter for backwards compatibility
                const legacyColorName = urlParams.get('color-name');

                if ((brandName && polymerName && labStr) || (legacyColorName && labStr)) {
                    // Parse LAB string with error handling
                    let lab;
                    try {
                        lab = parseLAB(labStr);
                    } catch (parseError) {
                        console.error('Error parsing LAB values:', parseError);
                        alert('Invalid shared link: The color data format is not recognized. Please check the link or request a new one.');
                        return;
                    }

                    // Validate LAB object exists and values are valid numbers
                    if (!isValidLab(lab)) {
                        console.error('Invalid LAB values in shared link:', labStr);
                        alert('Invalid shared link: The color information is corrupted or incomplete. Please request a new sharing link.');
                        return;
                    }

                    // Add the shared color to the table (don't sort yet - will sort after)
                    if (brandName && polymerName) {
                        // New format with separate brand and polymer
                        addUserColorRow(brandName, polymerName, lab, false);
                    } else {
                        // Legacy format with combined color name
                        addUserColorRow(legacyColorName, 'Personal color', lab, false);
                    }

                    // Save to localStorage so the shared color persists
                    saveUserColors();

                    // Sort the table once after adding
                    sortByAttribute('lightness', sortStates.lightness);

                    // Remove the query parameters from the URL without reloading the page
                    // Preserve hash fragment if present
                    const newUrl = window.location.origin + window.location.pathname + window.location.hash;
                    window.history.replaceState({}, document.title, newUrl);
                }
            } catch (error) {
                console.error('Error loading shared color from URL:', error);
                alert('Unable to load shared color: The link appears to be invalid or corrupted. Please check the URL or request a new sharing link.');
            }
        }

        // Load shared color if present in URL
        loadSharedColor();
    </script>
</body>
</html>
